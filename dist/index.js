"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const TransformChildren=Symbol("transform children");function transformChildren(t,r){if(null!=t){if(Array.isArray(t))return transformArray(t,r);if("object"==typeof t&&"function"==typeof t[TransformChildren])return t[TransformChildren](r)}return t}function transformArray(t,r){for(let n=0,e=t.length;n<e;++n){let i=t[n],a=r(i);if(i===a)continue;const s=t.slice(0,n),o=push;for(o(s,a),++n;n<e;++n)i=t[n],a=r(i),o(s,a);return s}return t}function push(t,r){null!=r&&(Array.isArray(r)?t.push(...r):t.push(r))}class Variable{constructor(t,r=null,n=null){this.name=t,this.fallbackType=r,this.fallback=n}toString(){var t,r;return"${"+this.name+(null!=(t=this.fallbackType)?t:"")+(null!=(r=this.fallback)?r:"")+"}"}[TransformChildren](t){const r=this.fallback,n=transformChildren(r,t);return n!==r?new Variable(this.name,this.fallbackType,n):this}}class VariableAssignment{constructor(t,r){this.name=t,this.value=r}toString(){return this.name+"="+this.value}[TransformChildren](t){const r=this.value,n=transformChildren(r,t);return n!==r?new VariableAssignment(this.name,n):this}}class SubstitutedVariable{constructor(t,r){this.name=t,this.value=r}toString(){let t=this.value;return t&&(t="string"==typeof t?t:t.toString()),"${"+this.name+"="+t+"}"}[TransformChildren](t){const r=this.value,n=transformChildren(r,t);return n!==r?new SubstitutedVariable(this.name,n):this}}class QuotedString{constructor(t){this.contents=t}toString(){return`"${this.contents}"`}[TransformChildren](t){const r=this.contents,n=transformChildren(r,t);return n!==r?new QuotedString(n):this}}class VerbatimString{constructor(t){this.contents=t}toString(){return`'${this.contents}'`}}class Word{constructor(t){this.contents=t}toString(){return`(${this.contents})`}}class Whitespace{constructor(t){this.contents=t}toString(){return`(${this.contents})`}}var tokens=Object.freeze({__proto__:null,Variable:Variable,VariableAssignment:VariableAssignment,SubstitutedVariable:SubstitutedVariable,QuotedString:QuotedString,VerbatimString:VerbatimString,Word:Word,Whitespace:Whitespace,TransformChildren:TransformChildren,transformChildren:transformChildren}),parser="use strict";function peg$subclass(t,r){function n(){this.constructor=t}n.prototype=r.prototype,t.prototype=new n}function peg$SyntaxError(t,r,n,e){this.message=t,this.expected=r,this.found=n,this.location=e,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(t,r){r=void 0!==r?r:{};var n,e={},i={start:gt},a=gt,s="=",o=ct("=",!1),u=function(t,r){return new kt(t,zt(r))},c="${",l=ct("${",!1),f=":-",h=ct(":-",!1),p=":=",g=ct(":=",!1),d="}",b=ct("}",!1),m=function(t,r,n){return new jt(t,r,n)},A=function(t){return new jt(t)},v="$",y=ct("$",!1),S=function(){return new _t("$")},x=function(t){return zt(t)},C={type:"other",description:"variable name"},V=/^[a-zA-Z_]/,$=lt([["a","z"],["A","Z"],"_"],!1,!1),W=/^[a-zA-Z_0-9]/,w=lt([["a","z"],["A","Z"],"_",["0","9"]],!1,!1),E=function(){return ut()},T=/^[ \t\n\r]/,_=lt([" ","\t","\n","\r"],!1,!1),j=function(){return new Ft(ut())},k="'",Q=ct("'",!1),F=function(t){return new _t(t)},z='"',R=ct('"',!1),Z=function(t){return new Tt(t)},M=function(t){return new Qt(t.join(""))},O=function(t){return t.join("")},P="\\",U=ct("\\",!1),q=/^[$"`\\]/,B=lt(["$",'"',"`","\\"],!1,!1),D=function(t){return t},G="\\\n",H=ct("\\\n",!1),I=function(){return""},J=/^[$"]/,K=lt(["$",'"'],!1,!1),L={type:"any"},N=function(t){return t},X=/^[$}'"]/,Y=lt(["$","}","'",'"'],!1,!1),tt=/^[$'"]/,rt=lt(["$","'",'"'],!1,!1),nt=0,et=0,it=[{line:1,column:1}],at=0,st=[],ot=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');a=i[r.startRule]}function ut(){return t.substring(et,nt)}function ct(t,r){return{type:"literal",text:t,ignoreCase:r}}function lt(t,r,n){return{type:"class",parts:t,inverted:r,ignoreCase:n}}function ft(r){var n,e=it[r];if(e)return e;for(n=r-1;!it[n];)n--;for(e={line:(e=it[n]).line,column:e.column};n<r;)10===t.charCodeAt(n)?(e.line++,e.column=1):e.column++,n++;return it[r]=e,e}function ht(t,r){var n=ft(t),e=ft(r);return{start:{offset:t,line:n.line,column:n.column},end:{offset:r,line:e.line,column:e.column}}}function pt(t){nt<at||(nt>at&&(at=nt,st=[]),st.push(t))}function gt(){var t,r;for(t=[],(r=bt())===e&&(r=dt())===e&&(r=vt());r!==e;)t.push(r),(r=bt())===e&&(r=dt())===e&&(r=vt());return t}function dt(){var t;return(t=yt())===e&&(t=St())===e&&(t=function(){var t,r,n;if(t=nt,r=[],(n=wt())!==e)for(;n!==e;)r.push(n),n=wt();else r=e;r!==e&&(et=t,r=M(r));return t=r}())===e&&(t=mt()),t}function bt(){var r,n,i,a,c;if(r=nt,(n=At())!==e)if(61===t.charCodeAt(nt)?(i=s,nt++):(i=e,0===ot&&pt(o)),i!==e){if(a=[],(c=dt())!==e)for(;c!==e;)a.push(c),c=dt();else a=e;a!==e?(et=r,r=n=u(n,a)):(nt=r,r=e)}else nt=r,r=e;else nt=r,r=e;return r}function mt(){var r,n,i,a,s,o;return r=nt,t.substr(nt,2)===c?(n=c,nt+=2):(n=e,0===ot&&pt(l)),n!==e&&(i=At())!==e?(t.substr(nt,2)===f?(a=f,nt+=2):(a=e,0===ot&&pt(h)),a===e&&(t.substr(nt,2)===p?(a=p,nt+=2):(a=e,0===ot&&pt(g))),a!==e&&(s=function(){var t,r,n;t=nt,r=[],(n=yt())===e&&(n=St())===e&&(n=xt())===e&&(n=mt())===e&&(n=vt());for(;n!==e;)r.push(n),(n=yt())===e&&(n=St())===e&&(n=xt())===e&&(n=mt())===e&&(n=vt());r!==e&&(et=t,r=x(r));return t=r}())!==e?(125===t.charCodeAt(nt)?(o=d,nt++):(o=e,0===ot&&pt(b)),o!==e?(et=r,r=n=m(i,a,s)):(nt=r,r=e)):(nt=r,r=e)):(nt=r,r=e),r===e&&(r=nt,t.substr(nt,2)===c?(n=c,nt+=2):(n=e,0===ot&&pt(l)),n!==e&&(i=At())!==e?(125===t.charCodeAt(nt)?(a=d,nt++):(a=e,0===ot&&pt(b)),a!==e?(et=r,r=n=A(i)):(nt=r,r=e)):(nt=r,r=e),r===e&&(r=nt,36===t.charCodeAt(nt)?(n=v,nt++):(n=e,0===ot&&pt(y)),n!==e&&(i=At())!==e?(et=r,r=n=A(i)):(nt=r,r=e),r===e&&(r=nt,36===t.charCodeAt(nt)?(n=v,nt++):(n=e,0===ot&&pt(y)),n!==e&&(et=r,n=S()),r=n))),r}function At(){var r,n,i,a;if(ot++,r=nt,V.test(t.charAt(nt))?(n=t.charAt(nt),nt++):(n=e,0===ot&&pt($)),n!==e){for(i=[],W.test(t.charAt(nt))?(a=t.charAt(nt),nt++):(a=e,0===ot&&pt(w));a!==e;)i.push(a),W.test(t.charAt(nt))?(a=t.charAt(nt),nt++):(a=e,0===ot&&pt(w));i!==e?(et=r,r=n=E()):(nt=r,r=e)}else nt=r,r=e;return ot--,r===e&&(n=e,0===ot&&pt(C)),r}function vt(){var r,n,i;if(r=nt,n=[],T.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(_)),i!==e)for(;i!==e;)n.push(i),T.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(_));else n=e;return n!==e&&(et=r,n=j()),r=n}function yt(){var r,n,i,a;return r=nt,39===t.charCodeAt(nt)?(n=k,nt++):(n=e,0===ot&&pt(Q)),n!==e&&(i=function(){var t,r,n;if(t=nt,r=[],(n=$t())!==e)for(;n!==e;)r.push(n),n=$t();else r=e;r!==e&&(et=t,r=O(r));return t=r}())!==e?(39===t.charCodeAt(nt)?(a=k,nt++):(a=e,0===ot&&pt(Q)),a!==e?(et=r,r=n=F(i)):(nt=r,r=e)):(nt=r,r=e),r}function St(){var r,n,i,a;if(r=nt,34===t.charCodeAt(nt)?(n=z,nt++):(n=e,0===ot&&pt(R)),n!==e){for(i=[],(a=Ct())===e&&(a=mt());a!==e;)i.push(a),(a=Ct())===e&&(a=mt());i!==e?(34===t.charCodeAt(nt)?(a=z,nt++):(a=e,0===ot&&pt(R)),a!==e?(et=r,r=n=Z(i)):(nt=r,r=e)):(nt=r,r=e)}else nt=r,r=e;return r}function xt(){var t,r,n;if(t=nt,r=[],(n=Wt())!==e)for(;n!==e;)r.push(n),n=Wt();else r=e;return r!==e&&(et=t,r=M(r)),t=r}function Ct(){var t,r,n;if(t=nt,r=[],(n=Vt())!==e)for(;n!==e;)r.push(n),n=Vt();else r=e;return r!==e&&(et=t,r=O(r)),t=r}function Vt(){var r,n,i;return r=nt,92===t.charCodeAt(nt)?(n=P,nt++):(n=e,0===ot&&pt(U)),n!==e?(q.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(B)),i!==e?(et=r,r=n=D(i)):(nt=r,r=e)):(nt=r,r=e),r===e&&(r=nt,t.substr(nt,2)===G?(n=G,nt+=2):(n=e,0===ot&&pt(H)),n!==e&&(et=r,n=I()),(r=n)===e&&(r=nt,n=nt,ot++,J.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(K)),ot--,i===e?n=void 0:(nt=n,n=e),n!==e?(t.length>nt?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(L)),i!==e?(et=r,r=n=N(i)):(nt=r,r=e)):(nt=r,r=e))),r}function $t(){var r,n,i;return r=nt,n=nt,ot++,39===t.charCodeAt(nt)?(i=k,nt++):(i=e,0===ot&&pt(Q)),ot--,i===e?n=void 0:(nt=n,n=e),n!==e?(t.length>nt?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(L)),i!==e?(et=r,r=n=N(i)):(nt=r,r=e)):(nt=r,r=e),r}function Wt(){var r,n,i;return(r=Et())===e&&(r=nt,n=nt,ot++,X.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(Y)),i===e&&(i=vt()),ot--,i===e?n=void 0:(nt=n,n=e),n!==e?(t.length>nt?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(L)),i!==e?(et=r,r=n=N(i)):(nt=r,r=e)):(nt=r,r=e)),r}function wt(){var r,n,i;return(r=Et())===e&&(r=nt,n=nt,ot++,tt.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(rt)),i===e&&(i=vt()),ot--,i===e?n=void 0:(nt=n,n=e),n!==e?(t.length>nt?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(L)),i!==e?(et=r,r=n=N(i)):(nt=r,r=e)):(nt=r,r=e)),r}function Et(){var r,n,i;return r=nt,t.substr(nt,2)===G?(n=G,nt+=2):(n=e,0===ot&&pt(H)),n!==e&&(et=r,n=I()),(r=n)===e&&(r=nt,92===t.charCodeAt(nt)?(n=P,nt++):(n=e,0===ot&&pt(U)),n!==e?(t.length>nt?(i=t.charAt(nt),nt++):(i=e,0===ot&&pt(L)),i!==e?(et=r,r=n=D(i)):(nt=r,r=e)):(nt=r,r=e)),r}const{QuotedString:Tt,VerbatimString:_t,Variable:jt,VariableAssignment:kt,Word:Qt,Whitespace:Ft}=tokens;function zt(t){return 1===t.length?t[0]:t}if((n=a())!==e&&nt===t.length)return n;throw n!==e&&nt<t.length&&pt({type:"end"}),Rt=st,Zt=at<t.length?t.charAt(at):null,Mt=at<t.length?ht(at,at+1):ht(at,at),new peg$SyntaxError(peg$SyntaxError.buildMessage(Rt,Zt),Rt,Zt,Mt);var Rt,Zt,Mt}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(t,r){var n={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var r,n="";for(r=0;r<t.parts.length;r++)n+=t.parts[r]instanceof Array?a(t.parts[r][0])+"-"+a(t.parts[r][1]):a(t.parts[r]);return"["+(t.inverted?"^":"")+n+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+e(t)}))}function a(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+e(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+e(t)}))}return"Expected "+function(t){var r,e,i,a=new Array(t.length);for(r=0;r<t.length;r++)a[r]=(i=t[r],n[i.type](i));if(a.sort(),a.length>0){for(r=1,e=1;r<a.length;r++)a[r-1]!==a[r]&&(a[e]=a[r],e++);a.length=e}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(r)+" found."};var parser_1=(parser={SyntaxError:peg$SyntaxError,parse:peg$parse}).parse;function collapseWhitespace(t){if(Array.isArray(t)){let r=!1,n=!1;return transformChildren(t,t=>{if(t instanceof Whitespace)return void(r=!0);const e=collapseWhitespace(t);if(null==e)return;const i=r&&n;return r=!1,n=!0,i?[new Whitespace(" "),e]:e})}if(t instanceof SubstitutedVariable){const r=t.value;if("string"==typeof r){const n=r.trim().replace(/\s+/g," ");return n===r?t:new SubstitutedVariable(t.name,n)}return collapseWhitespace(r)}return t}function stringify(t){var r;if(Array.isArray(t))return transformChildren(t,stringify).join("");if(t instanceof Variable)return null;if(t instanceof SubstitutedVariable){const r=t.value;return null==r?null:"string"==typeof r?r:stringify(r)}return t instanceof VariableAssignment?`${t.name}=${r=stringify(t.value),null!=r?r:""}`:t instanceof QuotedString?t.contents.reduce((t,r)=>{var n;return"string"==typeof r?t+r:t+(null!=(n=stringify(r))?n:"")},""):t instanceof Word||t instanceof VerbatimString||t instanceof Whitespace?t.contents:null}function substitute(t,r,n=!1){if(t instanceof Variable){let e=r[t.name];return e||(e=t.fallback?substitute(t.fallback,r,n):null),new SubstitutedVariable(t.name,e)}if(t instanceof VariableAssignment){const e=substitute(t.value,r,n),i=t.value===e?t:new VariableAssignment(t.name,e);if(n){const n=stringify(collapseWhitespace(e));r[t.name]=n}return i}return transformChildren(t,t=>substitute(t,r,n))}function toShellArgs(t){if(Array.isArray(t)){const r=[];let n=!1;for(const e of t)if(e instanceof Whitespace)n=!0;else{const t=toShellArgs(e);null!==t&&(n||0===r.length?r.push(t):r[r.length-1]+=t,n=!1)}return r}if(t instanceof Variable)return null;if(t instanceof SubstitutedVariable){return null==t.value?null:join(toShellArgs(t.value))}return t instanceof VariableAssignment?`${t.name}=${join(toShellArgs(t.value))}`:t instanceof QuotedString?t.contents.reduce((t,r)=>{var n;return"string"==typeof r?t+r:t+(null!=(n=join(toShellArgs(r)))?n:"")},""):t instanceof Word||t instanceof VerbatimString||t instanceof Whitespace?t.contents:void 0}function join(t){return null==t?"":"string"==typeof t?t:t.join("")}function extractEnvironment(t,r={}){const n=e=>{if(e instanceof VariableAssignment){const t=e,n=stringify(collapseWhitespace(substitute(t.value,r,!1)));r[t.name]=n}else transformChildren(t,n);return e};return n(t),r}const parse=t=>parser_1(t),replace=(t,r)=>{return stringify(collapseWhitespace(substitute(parser_1(t),r)))};exports.QuotedString=QuotedString,exports.SubstitutedVariable=SubstitutedVariable,exports.TransformChildren=TransformChildren,exports.Variable=Variable,exports.VariableAssignment=VariableAssignment,exports.VerbatimString=VerbatimString,exports.Whitespace=Whitespace,exports.Word=Word,exports.collapseWhitespace=collapseWhitespace,exports.extractEnvironment=extractEnvironment,exports.parse=parse,exports.replace=replace,exports.stringify=stringify,exports.substitute=substitute,exports.toShellArgs=toShellArgs,exports.transformChildren=transformChildren;
//# sourceMappingURL=index.js.map
