"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Variable{constructor(t,r=null,e=null){this.name=t,this.fallbackType=r,this.fallback=e,this.kind=2}stringify(t,r=!0){const e=t[this.name];return e?r?e.trim().replace(/\s+/g," "):e:this.fallback?this.fallback.stringify(t,r):null}toString(){return"${"+this.name+(this.fallbackType||"")+(this.fallback||"")+"}"}}class VariableAssignment{constructor(t,r){this.name=t,this.value=r,this.kind=3}stringify(){return""}toString(){return this.name+"="+this.value.toString()}}class QuotedString{constructor(t){this.contents=t,this.kind=5}stringify(t){return this.contents.reduce((r,e)=>("string"!=typeof e&&(e=e.stringify(t,!1)||""),r+e),"")}toString(){return`"${this.contents}"`}}class VerbatimString{constructor(t){this.contents=t,this.kind=6}stringify(){return this.contents}toString(){return`'${this.contents}'`}}class Word{constructor(t){this.contents=t,this.kind=4}stringify(){return this.contents}toString(){return`(${this.contents})`}}class List{constructor(t){this.items=t,this.kind=0}stringify(t,r=!0){if(r){let r=!1;return this.items.reduce((e,n)=>{if(1===n.kind)return r=!0,e;const i=n.stringify(t,!0);return null===i?e:(r&&""!==e&&(e+=" "),r=!1,e+i)},"")}return this.items.map(r=>r.stringify(t,!1)).filter(t=>null!==t).join("")}toString(){return`[${this.items}]`}}class Whitespace{constructor(t){this.contents=t,this.kind=1}stringify(t,r=!0){return r?" ":this.contents}toString(){return`(${this.contents})`}}!function(t){t[t.List=0]="List",t[t.Whitespace=1]="Whitespace",t[t.Variable=2]="Variable",t[t.VariableAssignment=3]="VariableAssignment",t[t.Text=4]="Text",t[t.QuotedText=5]="QuotedText",t[t.LiteralText=6]="LiteralText"}(exports.TokenKind||(exports.TokenKind={}));var tokens=Object.freeze({__proto__:null,Variable:Variable,VariableAssignment:VariableAssignment,QuotedString:QuotedString,VerbatimString:VerbatimString,Word:Word,List:List,Whitespace:Whitespace,get TokenKind(){return exports.TokenKind}}),parser="use strict";function peg$subclass(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function peg$SyntaxError(t,r,e,n){this.message=t,this.expected=r,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(t,r){r=void 0!==r?r:{};var e,n={},i={start:ft},s=ft,a=function(t){return new _t(t)},o="=",u=at("=",!1),c=function(t,r){return new Tt(t,r)},l="${",f=at("${",!1),h=":-",p=at(":-",!1),g=":=",d=at(":=",!1),A="}",x=at("}",!1),b=function(t,r,e){return new Et(t,r,e)},y=function(t){return new Et(t)},m="$",v=at("$",!1),S=function(){return new wt("$")},$=function(t){return 1===t.length?t[0]:new _t(t)},k={type:"other",description:"variable name"},V=/^[a-zA-Z_]/,C=ot([["a","z"],["A","Z"],"_"],!1,!1),w=/^[a-zA-z_0-9]/,E=ot([["a","z"],["A","z"],"_",["0","9"]],!1,!1),T=function(){return st()},W=/^[ \t\n\r]/,_=ot([" ","\t","\n","\r"],!1,!1),L=function(){return new Lt(st())},F="'",Q=at("'",!1),z=function(t){return new wt(t)},j='"',K=at('"',!1),R=function(t){return new Ct(t)},M=function(t){return new Wt(t.join(""))},O=function(t){return t.join("")},Z="\\",P=at("\\",!1),U=/^[$"`\\]/,q=ot(["$",'"',"`","\\"],!1,!1),B=function(t){return t},D="\\\n",G=at("\\\n",!1),H=function(){return""},I=/^[$"]/,J=ot(["$",'"'],!1,!1),N={type:"any"},X=function(t){return t},Y=0,tt=0,rt=[{line:1,column:1}],et=0,nt=[],it=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=i[r.startRule]}function st(){return t.substring(tt,Y)}function at(t,r){return{type:"literal",text:t,ignoreCase:r}}function ot(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function ut(r){var e,n=rt[r];if(n)return n;for(e=r-1;!rt[e];)e--;for(n={line:(n=rt[e]).line,column:n.column};e<r;)10===t.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return rt[r]=n,n}function ct(t,r){var e=ut(t),n=ut(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function lt(t){Y<et||(Y>et&&(et=Y,nt=[]),nt.push(t))}function ft(){var t,r,e;for(t=Y,r=[],(e=pt())===n&&(e=ht())===n&&(e=At());e!==n;)r.push(e),(e=pt())===n&&(e=ht())===n&&(e=At());return r!==n&&(tt=t,r=a(r)),t=r}function ht(){var t;return(t=xt())===n&&(t=bt())===n&&(t=function(){var t,r,e;if(t=Y,r=[],(e=kt())!==n)for(;e!==n;)r.push(e),e=kt();else r=n;r!==n&&(tt=t,r=M(r));return t=r}())===n&&(t=gt()),t}function pt(){var r,e,i,s;return r=Y,(e=dt())!==n?(61===t.charCodeAt(Y)?(i=o,Y++):(i=n,0===it&&lt(u)),i!==n&&(s=ht())!==n?(tt=r,r=e=c(e,s)):(Y=r,r=n)):(Y=r,r=n),r}function gt(){var r,e,i,s,a,o;return r=Y,t.substr(Y,2)===l?(e=l,Y+=2):(e=n,0===it&&lt(f)),e!==n&&(i=dt())!==n?(t.substr(Y,2)===h?(s=h,Y+=2):(s=n,0===it&&lt(p)),s===n&&(t.substr(Y,2)===g?(s=g,Y+=2):(s=n,0===it&&lt(d))),s!==n&&(a=function(){var t,r,e;t=Y,r=[],(e=xt())===n&&(e=bt())===n&&(e=yt())===n&&(e=gt())===n&&(e=At());for(;e!==n;)r.push(e),(e=xt())===n&&(e=bt())===n&&(e=yt())===n&&(e=gt())===n&&(e=At());r!==n&&(tt=t,r=$(r));return t=r}())!==n?(125===t.charCodeAt(Y)?(o=A,Y++):(o=n,0===it&&lt(x)),o!==n?(tt=r,r=e=b(i,s,a)):(Y=r,r=n)):(Y=r,r=n)):(Y=r,r=n),r===n&&(r=Y,t.substr(Y,2)===l?(e=l,Y+=2):(e=n,0===it&&lt(f)),e!==n&&(i=dt())!==n?(125===t.charCodeAt(Y)?(s=A,Y++):(s=n,0===it&&lt(x)),s!==n?(tt=r,r=e=y(i)):(Y=r,r=n)):(Y=r,r=n),r===n&&(r=Y,36===t.charCodeAt(Y)?(e=m,Y++):(e=n,0===it&&lt(v)),e!==n&&(i=dt())!==n?(tt=r,r=e=y(i)):(Y=r,r=n),r===n&&(r=Y,36===t.charCodeAt(Y)?(e=m,Y++):(e=n,0===it&&lt(v)),e!==n&&(tt=r,e=S()),r=e))),r}function dt(){var r,e,i,s;if(it++,r=Y,V.test(t.charAt(Y))?(e=t.charAt(Y),Y++):(e=n,0===it&&lt(C)),e!==n){if(i=[],w.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===it&&lt(E)),s!==n)for(;s!==n;)i.push(s),w.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===it&&lt(E));else i=n;i!==n?(tt=r,r=e=T()):(Y=r,r=n)}else Y=r,r=n;return it--,r===n&&(e=n,0===it&&lt(k)),r}function At(){var r,e,i;if(r=Y,e=[],W.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(_)),i!==n)for(;i!==n;)e.push(i),W.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(_));else e=n;return e!==n&&(tt=r,e=L()),r=e}function xt(){var r,e,i,s;return r=Y,39===t.charCodeAt(Y)?(e=F,Y++):(e=n,0===it&&lt(Q)),e!==n&&(i=function(){var t,r,e;if(t=Y,r=[],(e=St())!==n)for(;e!==n;)r.push(e),e=St();else r=n;r!==n&&(tt=t,r=O(r));return t=r}())!==n?(39===t.charCodeAt(Y)?(s=F,Y++):(s=n,0===it&&lt(Q)),s!==n?(tt=r,r=e=z(i)):(Y=r,r=n)):(Y=r,r=n),r}function bt(){var r,e,i,s;if(r=Y,34===t.charCodeAt(Y)?(e=j,Y++):(e=n,0===it&&lt(K)),e!==n){for(i=[],(s=mt())===n&&(s=gt());s!==n;)i.push(s),(s=mt())===n&&(s=gt());i!==n?(34===t.charCodeAt(Y)?(s=j,Y++):(s=n,0===it&&lt(K)),s!==n?(tt=r,r=e=R(i)):(Y=r,r=n)):(Y=r,r=n)}else Y=r,r=n;return r}function yt(){var t,r,e;if(t=Y,r=[],(e=$t())!==n)for(;e!==n;)r.push(e),e=$t();else r=n;return r!==n&&(tt=t,r=M(r)),t=r}function mt(){var t,r,e;if(t=Y,r=[],(e=vt())!==n)for(;e!==n;)r.push(e),e=vt();else r=n;return r!==n&&(tt=t,r=O(r)),t=r}function vt(){var r,e,i;return r=Y,92===t.charCodeAt(Y)?(e=Z,Y++):(e=n,0===it&&lt(P)),e!==n?(U.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(q)),i!==n?(tt=r,r=e=B(i)):(Y=r,r=n)):(Y=r,r=n),r===n&&(r=Y,t.substr(Y,2)===D?(e=D,Y+=2):(e=n,0===it&&lt(G)),e!==n&&(tt=r,e=H()),(r=e)===n&&(r=Y,e=Y,it++,I.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(J)),it--,i===n?e=void 0:(Y=e,e=n),e!==n?(t.length>Y?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(N)),i!==n?(tt=r,r=e=X(i)):(Y=r,r=n)):(Y=r,r=n))),r}function St(){var r,e,i;return r=Y,e=Y,it++,39===t.charCodeAt(Y)?(i=F,Y++):(i=n,0===it&&lt(Q)),it--,i===n?e=void 0:(Y=e,e=n),e!==n?(t.length>Y?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(N)),i!==n?(tt=r,r=e=X(i)):(Y=r,r=n)):(Y=r,r=n),r}function $t(){var r,e,i;return(r=Vt())===n&&(r=Y,e=Y,it++,36===t.charCodeAt(Y)?(i=m,Y++):(i=n,0===it&&lt(v)),i===n&&(125===t.charCodeAt(Y)?(i=A,Y++):(i=n,0===it&&lt(x)),i===n&&(i=At())),it--,i===n?e=void 0:(Y=e,e=n),e!==n?(t.length>Y?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(N)),i!==n?(tt=r,r=e=X(i)):(Y=r,r=n)):(Y=r,r=n)),r}function kt(){var r,e,i;return(r=Vt())===n&&(r=Y,e=Y,it++,36===t.charCodeAt(Y)?(i=m,Y++):(i=n,0===it&&lt(v)),i===n&&(i=At()),it--,i===n?e=void 0:(Y=e,e=n),e!==n?(t.length>Y?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(N)),i!==n?(tt=r,r=e=X(i)):(Y=r,r=n)):(Y=r,r=n)),r}function Vt(){var r,e,i;return r=Y,t.substr(Y,2)===D?(e=D,Y+=2):(e=n,0===it&&lt(G)),e!==n&&(tt=r,e=H()),(r=e)===n&&(r=Y,92===t.charCodeAt(Y)?(e=Z,Y++):(e=n,0===it&&lt(P)),e!==n?(t.length>Y?(i=t.charAt(Y),Y++):(i=n,0===it&&lt(N)),i!==n?(tt=r,r=e=B(i)):(Y=r,r=n)):(Y=r,r=n)),r}const{QuotedString:Ct,VerbatimString:wt,Variable:Et,VariableAssignment:Tt,Word:Wt,List:_t,Whitespace:Lt}=tokens;if((e=s())!==n&&Y===t.length)return e;throw e!==n&&Y<t.length&&lt({type:"end"}),Ft=nt,Qt=et<t.length?t.charAt(et):null,zt=et<t.length?ct(et,et+1):ct(et,et),new peg$SyntaxError(peg$SyntaxError.buildMessage(Ft,Qt),Ft,Qt,zt);var Ft,Qt,zt}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(t,r){var e={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?s(t.parts[r][0])+"-"+s(t.parts[r][1]):s(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var r,n,i,s=new Array(t.length);for(r=0;r<t.length;r++)s[r]=(i=t[r],e[i.type](i));if(s.sort(),s.length>0){for(r=1,n=1;r<s.length;r++)s[r-1]!==s[r]&&(s[n]=s[r],n++);s.length=n}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(r)+" found."};var parser_1=(parser={SyntaxError:peg$SyntaxError,parse:peg$parse}).parse;const parse=t=>parser_1(t),replace=(t,r)=>{return parser_1(t).stringify(r)};exports.List=List,exports.QuotedString=QuotedString,exports.Variable=Variable,exports.VariableAssignment=VariableAssignment,exports.VerbatimString=VerbatimString,exports.Whitespace=Whitespace,exports.Word=Word,exports.parse=parse,exports.replace=replace;
//# sourceMappingURL=index.js.map
