"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Variable{constructor(t,r=null,e=null){this.name=t,this.fallbackType=r,this.fallback=e,this.kind=2}stringify(t,r=!0){const e=t[this.name];return e?r?e.trim().replace(/\s+/g," "):e:this.fallback?this.fallback.stringify(t,r):null}toString(){return"${"+this.name+(this.fallbackType||"")+(this.fallback||"")+"}"}}class VariableAssignment{constructor(t,r){this.name=t,this.value=r,this.kind=3}stringify(t,r=!0){return`${this.name}=${this.value.stringify(t,r)}`}toString(){return this.name+"="+this.value.toString()}}class QuotedString{constructor(t){this.contents=t,this.kind=5}stringify(t){return this.contents.reduce((r,e)=>("string"!=typeof e&&(e=e.stringify(t,!1)||""),r+e),"")}toString(){return`"${this.contents}"`}}class VerbatimString{constructor(t){this.contents=t,this.kind=6}stringify(){return this.contents}toString(){return`'${this.contents}'`}}class Word{constructor(t){this.contents=t,this.kind=4}stringify(){return this.contents}toString(){return`(${this.contents})`}}class List{constructor(t){this.items=t,this.kind=0}stringify(t,r=!0){if(r){let r=!1;return this.items.reduce((e,n)=>{if(1===n.kind)return r=!0,e;const i=n.stringify(t,!0);return null===i?e:(r&&""!==e&&(e+=" "),r=!1,e+i)},"")}return this.items.map(r=>r.stringify(t,!1)).filter(t=>null!==t).join("")}toString(){return`[${this.items}]`}}class Whitespace{constructor(t){this.contents=t,this.kind=1}stringify(t,r=!0){return r?" ":this.contents}toString(){return`(${this.contents})`}}!function(t){t[t.List=0]="List",t[t.Whitespace=1]="Whitespace",t[t.Variable=2]="Variable",t[t.VariableAssignment=3]="VariableAssignment",t[t.Text=4]="Text",t[t.QuotedText=5]="QuotedText",t[t.LiteralText=6]="LiteralText"}(exports.TokenKind||(exports.TokenKind={}));var tokens=Object.freeze({__proto__:null,Variable:Variable,VariableAssignment:VariableAssignment,QuotedString:QuotedString,VerbatimString:VerbatimString,Word:Word,List:List,Whitespace:Whitespace,get TokenKind(){return exports.TokenKind}}),parser="use strict";function peg$subclass(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}function peg$SyntaxError(t,r,e,n){this.message=t,this.expected=r,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(t,r){r=void 0!==r?r:{};var e,n={},i={start:dt},s=dt,a=function(t){return new jt(t)},o="=",u=lt("=",!1),c=function(t,r){return new Ft(t,new jt(r))},l="${",f=lt("${",!1),h=":-",p=lt(":-",!1),g=":=",d=lt(":=",!1),A="}",x=lt("}",!1),b=function(t,r,e){return new Lt(t,r,e)},y=function(t){return new Lt(t)},m="$",v=lt("$",!1),S=function(){return new _t("$")},$=function(t){return 1===t.length?t[0]:new jt(t)},k={type:"other",description:"variable name"},V=/^[a-zA-Z_]/,w=ft([["a","z"],["A","Z"],"_"],!1,!1),C=/^[a-zA-Z_0-9]/,E=ft([["a","z"],["A","Z"],"_",["0","9"]],!1,!1),T=function(){return ct()},W=/^[ \t\n\r]/,_=ft([" ","\t","\n","\r"],!1,!1),L=function(){return new zt(ct())},F="'",Q=lt("'",!1),j=function(t){return new _t(t)},z='"',K=lt('"',!1),R=function(t){return new Wt(t)},Z=function(t){return new Qt(t.join(""))},M=function(t){return t.join("")},O="\\",P=lt("\\",!1),U=/^[$"`\\]/,q=ft(["$",'"',"`","\\"],!1,!1),B=function(t){return t},D="\\\n",G=lt("\\\n",!1),H=function(){return""},I=/^[$"]/,J=ft(["$",'"'],!1,!1),N={type:"any"},X=function(t){return t},Y=/^[$}'"]/,tt=ft(["$","}","'",'"'],!1,!1),rt=/^[$'"]/,et=ft(["$","'",'"'],!1,!1),nt=0,it=0,st=[{line:1,column:1}],at=0,ot=[],ut=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=i[r.startRule]}function ct(){return t.substring(it,nt)}function lt(t,r){return{type:"literal",text:t,ignoreCase:r}}function ft(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function ht(r){var e,n=st[r];if(n)return n;for(e=r-1;!st[e];)e--;for(n={line:(n=st[e]).line,column:n.column};e<r;)10===t.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return st[r]=n,n}function pt(t,r){var e=ht(t),n=ht(r);return{start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function gt(t){nt<at||(nt>at&&(at=nt,ot=[]),ot.push(t))}function dt(){var t,r,e;for(t=nt,r=[],(e=xt())===n&&(e=At())===n&&(e=mt());e!==n;)r.push(e),(e=xt())===n&&(e=At())===n&&(e=mt());return r!==n&&(it=t,r=a(r)),t=r}function At(){var t;return(t=vt())===n&&(t=St())===n&&(t=function(){var t,r,e;if(t=nt,r=[],(e=Et())!==n)for(;e!==n;)r.push(e),e=Et();else r=n;r!==n&&(it=t,r=Z(r));return t=r}())===n&&(t=bt()),t}function xt(){var r,e,i,s,a;if(r=nt,(e=yt())!==n)if(61===t.charCodeAt(nt)?(i=o,nt++):(i=n,0===ut&&gt(u)),i!==n){if(s=[],(a=At())!==n)for(;a!==n;)s.push(a),a=At();else s=n;s!==n?(it=r,r=e=c(e,s)):(nt=r,r=n)}else nt=r,r=n;else nt=r,r=n;return r}function bt(){var r,e,i,s,a,o;return r=nt,t.substr(nt,2)===l?(e=l,nt+=2):(e=n,0===ut&&gt(f)),e!==n&&(i=yt())!==n?(t.substr(nt,2)===h?(s=h,nt+=2):(s=n,0===ut&&gt(p)),s===n&&(t.substr(nt,2)===g?(s=g,nt+=2):(s=n,0===ut&&gt(d))),s!==n&&(a=function(){var t,r,e;t=nt,r=[],(e=vt())===n&&(e=St())===n&&(e=$t())===n&&(e=bt())===n&&(e=mt());for(;e!==n;)r.push(e),(e=vt())===n&&(e=St())===n&&(e=$t())===n&&(e=bt())===n&&(e=mt());r!==n&&(it=t,r=$(r));return t=r}())!==n?(125===t.charCodeAt(nt)?(o=A,nt++):(o=n,0===ut&&gt(x)),o!==n?(it=r,r=e=b(i,s,a)):(nt=r,r=n)):(nt=r,r=n)):(nt=r,r=n),r===n&&(r=nt,t.substr(nt,2)===l?(e=l,nt+=2):(e=n,0===ut&&gt(f)),e!==n&&(i=yt())!==n?(125===t.charCodeAt(nt)?(s=A,nt++):(s=n,0===ut&&gt(x)),s!==n?(it=r,r=e=y(i)):(nt=r,r=n)):(nt=r,r=n),r===n&&(r=nt,36===t.charCodeAt(nt)?(e=m,nt++):(e=n,0===ut&&gt(v)),e!==n&&(i=yt())!==n?(it=r,r=e=y(i)):(nt=r,r=n),r===n&&(r=nt,36===t.charCodeAt(nt)?(e=m,nt++):(e=n,0===ut&&gt(v)),e!==n&&(it=r,e=S()),r=e))),r}function yt(){var r,e,i,s;if(ut++,r=nt,V.test(t.charAt(nt))?(e=t.charAt(nt),nt++):(e=n,0===ut&&gt(w)),e!==n){for(i=[],C.test(t.charAt(nt))?(s=t.charAt(nt),nt++):(s=n,0===ut&&gt(E));s!==n;)i.push(s),C.test(t.charAt(nt))?(s=t.charAt(nt),nt++):(s=n,0===ut&&gt(E));i!==n?(it=r,r=e=T()):(nt=r,r=n)}else nt=r,r=n;return ut--,r===n&&(e=n,0===ut&&gt(k)),r}function mt(){var r,e,i;if(r=nt,e=[],W.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(_)),i!==n)for(;i!==n;)e.push(i),W.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(_));else e=n;return e!==n&&(it=r,e=L()),r=e}function vt(){var r,e,i,s;return r=nt,39===t.charCodeAt(nt)?(e=F,nt++):(e=n,0===ut&&gt(Q)),e!==n&&(i=function(){var t,r,e;if(t=nt,r=[],(e=wt())!==n)for(;e!==n;)r.push(e),e=wt();else r=n;r!==n&&(it=t,r=M(r));return t=r}())!==n?(39===t.charCodeAt(nt)?(s=F,nt++):(s=n,0===ut&&gt(Q)),s!==n?(it=r,r=e=j(i)):(nt=r,r=n)):(nt=r,r=n),r}function St(){var r,e,i,s;if(r=nt,34===t.charCodeAt(nt)?(e=z,nt++):(e=n,0===ut&&gt(K)),e!==n){for(i=[],(s=kt())===n&&(s=bt());s!==n;)i.push(s),(s=kt())===n&&(s=bt());i!==n?(34===t.charCodeAt(nt)?(s=z,nt++):(s=n,0===ut&&gt(K)),s!==n?(it=r,r=e=R(i)):(nt=r,r=n)):(nt=r,r=n)}else nt=r,r=n;return r}function $t(){var t,r,e;if(t=nt,r=[],(e=Ct())!==n)for(;e!==n;)r.push(e),e=Ct();else r=n;return r!==n&&(it=t,r=Z(r)),t=r}function kt(){var t,r,e;if(t=nt,r=[],(e=Vt())!==n)for(;e!==n;)r.push(e),e=Vt();else r=n;return r!==n&&(it=t,r=M(r)),t=r}function Vt(){var r,e,i;return r=nt,92===t.charCodeAt(nt)?(e=O,nt++):(e=n,0===ut&&gt(P)),e!==n?(U.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(q)),i!==n?(it=r,r=e=B(i)):(nt=r,r=n)):(nt=r,r=n),r===n&&(r=nt,t.substr(nt,2)===D?(e=D,nt+=2):(e=n,0===ut&&gt(G)),e!==n&&(it=r,e=H()),(r=e)===n&&(r=nt,e=nt,ut++,I.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(J)),ut--,i===n?e=void 0:(nt=e,e=n),e!==n?(t.length>nt?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(N)),i!==n?(it=r,r=e=X(i)):(nt=r,r=n)):(nt=r,r=n))),r}function wt(){var r,e,i;return r=nt,e=nt,ut++,39===t.charCodeAt(nt)?(i=F,nt++):(i=n,0===ut&&gt(Q)),ut--,i===n?e=void 0:(nt=e,e=n),e!==n?(t.length>nt?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(N)),i!==n?(it=r,r=e=X(i)):(nt=r,r=n)):(nt=r,r=n),r}function Ct(){var r,e,i;return(r=Tt())===n&&(r=nt,e=nt,ut++,Y.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(tt)),i===n&&(i=mt()),ut--,i===n?e=void 0:(nt=e,e=n),e!==n?(t.length>nt?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(N)),i!==n?(it=r,r=e=X(i)):(nt=r,r=n)):(nt=r,r=n)),r}function Et(){var r,e,i;return(r=Tt())===n&&(r=nt,e=nt,ut++,rt.test(t.charAt(nt))?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(et)),i===n&&(i=mt()),ut--,i===n?e=void 0:(nt=e,e=n),e!==n?(t.length>nt?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(N)),i!==n?(it=r,r=e=X(i)):(nt=r,r=n)):(nt=r,r=n)),r}function Tt(){var r,e,i;return r=nt,t.substr(nt,2)===D?(e=D,nt+=2):(e=n,0===ut&&gt(G)),e!==n&&(it=r,e=H()),(r=e)===n&&(r=nt,92===t.charCodeAt(nt)?(e=O,nt++):(e=n,0===ut&&gt(P)),e!==n?(t.length>nt?(i=t.charAt(nt),nt++):(i=n,0===ut&&gt(N)),i!==n?(it=r,r=e=B(i)):(nt=r,r=n)):(nt=r,r=n)),r}const{QuotedString:Wt,VerbatimString:_t,Variable:Lt,VariableAssignment:Ft,Word:Qt,List:jt,Whitespace:zt}=tokens;if((e=s())!==n&&nt===t.length)return e;throw e!==n&&nt<t.length&&gt({type:"end"}),Kt=ot,Rt=at<t.length?t.charAt(at):null,Zt=at<t.length?pt(at,at+1):pt(at,at),new peg$SyntaxError(peg$SyntaxError.buildMessage(Kt,Rt),Kt,Rt,Zt);var Kt,Rt,Zt}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(t,r){var e={literal:function(t){return'"'+i(t.text)+'"'},class:function(t){var r,e="";for(r=0;r<t.parts.length;r++)e+=t.parts[r]instanceof Array?s(t.parts[r][0])+"-"+s(t.parts[r][1]):s(t.parts[r]);return"["+(t.inverted?"^":"")+e+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function i(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function s(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var r,n,i,s=new Array(t.length);for(r=0;r<t.length;r++)s[r]=(i=t[r],e[i.type](i));if(s.sort(),s.length>0){for(r=1,n=1;r<s.length;r++)s[r-1]!==s[r]&&(s[n]=s[r],n++);s.length=n}switch(s.length){case 1:return s[0];case 2:return s[0]+" or "+s[1];default:return s.slice(0,-1).join(", ")+", or "+s[s.length-1]}}(t)+" but "+function(t){return t?'"'+i(t)+'"':"end of input"}(r)+" found."};var parser_1=(parser={SyntaxError:peg$SyntaxError,parse:peg$parse}).parse;const parse=t=>parser_1(t),replace=(t,r)=>{return parser_1(t).stringify(r)};exports.List=List,exports.QuotedString=QuotedString,exports.Variable=Variable,exports.VariableAssignment=VariableAssignment,exports.VerbatimString=VerbatimString,exports.Whitespace=Whitespace,exports.Word=Word,exports.parse=parse,exports.replace=replace;
//# sourceMappingURL=index.js.map
