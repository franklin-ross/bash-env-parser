"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class Variable{constructor(t,e=null,r=null){this.name=t,this.fallbackType=e,this.fallback=r,this.kind=2}toString(){return"${"+this.name+(this.fallbackType||"")+(this.fallback||"")+"}"}}class VariableAssignment{constructor(t,e){this.name=t,this.value=e,this.kind=3}toString(){return this.name+"="+this.value.toString()}}class SubstitutedVariable{constructor(t,e=null){this.name=t,this.value=e,this.kind=4}toString(){let t=this.value;return t&&(t="string"==typeof t?t:t.toString()),"${"+this.name+"="+t+"}"}}class QuotedString{constructor(t){this.contents=t,this.kind=6}toString(){return`"${this.contents}"`}}class VerbatimString{constructor(t){this.contents=t,this.kind=7}toString(){return`'${this.contents}'`}}class Word{constructor(t){this.contents=t,this.kind=5}toString(){return`(${this.contents})`}}class List{constructor(t){this.items=t,this.kind=0}toString(){return`[${this.items}]`}}class Whitespace{constructor(t){this.contents=t,this.kind=1}toString(){return`(${this.contents})`}}!function(t){t[t.List=0]="List",t[t.Whitespace=1]="Whitespace",t[t.Variable=2]="Variable",t[t.VariableAssignment=3]="VariableAssignment",t[t.SubstitutedVariable=4]="SubstitutedVariable",t[t.Text=5]="Text",t[t.QuotedText=6]="QuotedText",t[t.LiteralText=7]="LiteralText"}(exports.TokenKind||(exports.TokenKind={}));var tokens=Object.freeze({__proto__:null,Variable:Variable,VariableAssignment:VariableAssignment,SubstitutedVariable:SubstitutedVariable,QuotedString:QuotedString,VerbatimString:VerbatimString,Word:Word,List:List,Whitespace:Whitespace,get TokenKind(){return exports.TokenKind}}),parser="use strict";function peg$subclass(t,e){function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r}function peg$SyntaxError(t,e,r,n){this.message=t,this.expected=e,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,peg$SyntaxError)}function peg$parse(t,e){e=void 0!==e?e:{};var r,n={},s={start:ht},i=ht,a=function(t){return new _t(t)},u="=",o=at("=",!1),c=function(t,e){return new Et(t,new _t(e))},l="${",h=at("${",!1),p=":-",f=at(":-",!1),g=":=",d=at(":=",!1),b="}",A=at("}",!1),x=function(t,e,r){return new Wt(t,e,r)},S=function(t){return new Wt(t)},m="$",v=at("$",!1),y=function(){return new Ct("$")},V=function(t){return 1===t.length?t[0]:new _t(t)},$={type:"other",description:"variable name"},w=/^[a-zA-Z_]/,k=ut([["a","z"],["A","Z"],"_"],!1,!1),C=/^[a-zA-z_0-9]/,W=ut([["a","z"],["A","z"],"_",["0","9"]],!1,!1),E=function(){return it()},T=/^[ \t\n\r]/,_=ut([" ","\t","\n","\r"],!1,!1),L=function(){return new Lt(it())},j="'",Q=at("'",!1),F=function(t){return new Ct(t)},z='"',K=at('"',!1),R=function(t){return new kt(t)},M=function(t){return new Tt(t.join(""))},O=function(t){return t.join("")},Z="\\",P=at("\\",!1),U=/^[$"`\\]/,q=ut(["$",'"',"`","\\"],!1,!1),B=function(t){return t},D="\\\n",G=at("\\\n",!1),H=function(){return""},I=/^[$"]/,J=ut(["$",'"'],!1,!1),N={type:"any"},X=function(t){return t},Y=0,tt=0,et=[{line:1,column:1}],rt=0,nt=[],st=0;if("startRule"in e){if(!(e.startRule in s))throw new Error("Can't start parsing from rule \""+e.startRule+'".');i=s[e.startRule]}function it(){return t.substring(tt,Y)}function at(t,e){return{type:"literal",text:t,ignoreCase:e}}function ut(t,e,r){return{type:"class",parts:t,inverted:e,ignoreCase:r}}function ot(e){var r,n=et[e];if(n)return n;for(r=e-1;!et[r];)r--;for(n={line:(n=et[r]).line,column:n.column};r<e;)10===t.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return et[e]=n,n}function ct(t,e){var r=ot(t),n=ot(e);return{start:{offset:t,line:r.line,column:r.column},end:{offset:e,line:n.line,column:n.column}}}function lt(t){Y<rt||(Y>rt&&(rt=Y,nt=[]),nt.push(t))}function ht(){var t,e,r;for(t=Y,e=[],(r=ft())===n&&(r=pt())===n&&(r=bt());r!==n;)e.push(r),(r=ft())===n&&(r=pt())===n&&(r=bt());return e!==n&&(tt=t,e=a(e)),t=e}function pt(){var t;return(t=At())===n&&(t=xt())===n&&(t=function(){var t,e,r;if(t=Y,e=[],(r=$t())!==n)for(;r!==n;)e.push(r),r=$t();else e=n;e!==n&&(tt=t,e=M(e));return t=e}())===n&&(t=gt()),t}function ft(){var e,r,s,i,a;if(e=Y,(r=dt())!==n)if(61===t.charCodeAt(Y)?(s=u,Y++):(s=n,0===st&&lt(o)),s!==n){if(i=[],(a=pt())!==n)for(;a!==n;)i.push(a),a=pt();else i=n;i!==n?(tt=e,e=r=c(r,i)):(Y=e,e=n)}else Y=e,e=n;else Y=e,e=n;return e}function gt(){var e,r,s,i,a,u;return e=Y,t.substr(Y,2)===l?(r=l,Y+=2):(r=n,0===st&&lt(h)),r!==n&&(s=dt())!==n?(t.substr(Y,2)===p?(i=p,Y+=2):(i=n,0===st&&lt(f)),i===n&&(t.substr(Y,2)===g?(i=g,Y+=2):(i=n,0===st&&lt(d))),i!==n&&(a=function(){var t,e,r;t=Y,e=[],(r=At())===n&&(r=xt())===n&&(r=St())===n&&(r=gt())===n&&(r=bt());for(;r!==n;)e.push(r),(r=At())===n&&(r=xt())===n&&(r=St())===n&&(r=gt())===n&&(r=bt());e!==n&&(tt=t,e=V(e));return t=e}())!==n?(125===t.charCodeAt(Y)?(u=b,Y++):(u=n,0===st&&lt(A)),u!==n?(tt=e,e=r=x(s,i,a)):(Y=e,e=n)):(Y=e,e=n)):(Y=e,e=n),e===n&&(e=Y,t.substr(Y,2)===l?(r=l,Y+=2):(r=n,0===st&&lt(h)),r!==n&&(s=dt())!==n?(125===t.charCodeAt(Y)?(i=b,Y++):(i=n,0===st&&lt(A)),i!==n?(tt=e,e=r=S(s)):(Y=e,e=n)):(Y=e,e=n),e===n&&(e=Y,36===t.charCodeAt(Y)?(r=m,Y++):(r=n,0===st&&lt(v)),r!==n&&(s=dt())!==n?(tt=e,e=r=S(s)):(Y=e,e=n),e===n&&(e=Y,36===t.charCodeAt(Y)?(r=m,Y++):(r=n,0===st&&lt(v)),r!==n&&(tt=e,r=y()),e=r))),e}function dt(){var e,r,s,i;if(st++,e=Y,w.test(t.charAt(Y))?(r=t.charAt(Y),Y++):(r=n,0===st&&lt(k)),r!==n){if(s=[],C.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===st&&lt(W)),i!==n)for(;i!==n;)s.push(i),C.test(t.charAt(Y))?(i=t.charAt(Y),Y++):(i=n,0===st&&lt(W));else s=n;s!==n?(tt=e,e=r=E()):(Y=e,e=n)}else Y=e,e=n;return st--,e===n&&(r=n,0===st&&lt($)),e}function bt(){var e,r,s;if(e=Y,r=[],T.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(_)),s!==n)for(;s!==n;)r.push(s),T.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(_));else r=n;return r!==n&&(tt=e,r=L()),e=r}function At(){var e,r,s,i;return e=Y,39===t.charCodeAt(Y)?(r=j,Y++):(r=n,0===st&&lt(Q)),r!==n&&(s=function(){var t,e,r;if(t=Y,e=[],(r=yt())!==n)for(;r!==n;)e.push(r),r=yt();else e=n;e!==n&&(tt=t,e=O(e));return t=e}())!==n?(39===t.charCodeAt(Y)?(i=j,Y++):(i=n,0===st&&lt(Q)),i!==n?(tt=e,e=r=F(s)):(Y=e,e=n)):(Y=e,e=n),e}function xt(){var e,r,s,i;if(e=Y,34===t.charCodeAt(Y)?(r=z,Y++):(r=n,0===st&&lt(K)),r!==n){for(s=[],(i=mt())===n&&(i=gt());i!==n;)s.push(i),(i=mt())===n&&(i=gt());s!==n?(34===t.charCodeAt(Y)?(i=z,Y++):(i=n,0===st&&lt(K)),i!==n?(tt=e,e=r=R(s)):(Y=e,e=n)):(Y=e,e=n)}else Y=e,e=n;return e}function St(){var t,e,r;if(t=Y,e=[],(r=Vt())!==n)for(;r!==n;)e.push(r),r=Vt();else e=n;return e!==n&&(tt=t,e=M(e)),t=e}function mt(){var t,e,r;if(t=Y,e=[],(r=vt())!==n)for(;r!==n;)e.push(r),r=vt();else e=n;return e!==n&&(tt=t,e=O(e)),t=e}function vt(){var e,r,s;return e=Y,92===t.charCodeAt(Y)?(r=Z,Y++):(r=n,0===st&&lt(P)),r!==n?(U.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(q)),s!==n?(tt=e,e=r=B(s)):(Y=e,e=n)):(Y=e,e=n),e===n&&(e=Y,t.substr(Y,2)===D?(r=D,Y+=2):(r=n,0===st&&lt(G)),r!==n&&(tt=e,r=H()),(e=r)===n&&(e=Y,r=Y,st++,I.test(t.charAt(Y))?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(J)),st--,s===n?r=void 0:(Y=r,r=n),r!==n?(t.length>Y?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(N)),s!==n?(tt=e,e=r=X(s)):(Y=e,e=n)):(Y=e,e=n))),e}function yt(){var e,r,s;return e=Y,r=Y,st++,39===t.charCodeAt(Y)?(s=j,Y++):(s=n,0===st&&lt(Q)),st--,s===n?r=void 0:(Y=r,r=n),r!==n?(t.length>Y?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(N)),s!==n?(tt=e,e=r=X(s)):(Y=e,e=n)):(Y=e,e=n),e}function Vt(){var e,r,s;return(e=wt())===n&&(e=Y,r=Y,st++,36===t.charCodeAt(Y)?(s=m,Y++):(s=n,0===st&&lt(v)),s===n&&(125===t.charCodeAt(Y)?(s=b,Y++):(s=n,0===st&&lt(A)),s===n&&(s=bt())),st--,s===n?r=void 0:(Y=r,r=n),r!==n?(t.length>Y?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(N)),s!==n?(tt=e,e=r=X(s)):(Y=e,e=n)):(Y=e,e=n)),e}function $t(){var e,r,s;return(e=wt())===n&&(e=Y,r=Y,st++,36===t.charCodeAt(Y)?(s=m,Y++):(s=n,0===st&&lt(v)),s===n&&(s=bt()),st--,s===n?r=void 0:(Y=r,r=n),r!==n?(t.length>Y?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(N)),s!==n?(tt=e,e=r=X(s)):(Y=e,e=n)):(Y=e,e=n)),e}function wt(){var e,r,s;return e=Y,t.substr(Y,2)===D?(r=D,Y+=2):(r=n,0===st&&lt(G)),r!==n&&(tt=e,r=H()),(e=r)===n&&(e=Y,92===t.charCodeAt(Y)?(r=Z,Y++):(r=n,0===st&&lt(P)),r!==n?(t.length>Y?(s=t.charAt(Y),Y++):(s=n,0===st&&lt(N)),s!==n?(tt=e,e=r=B(s)):(Y=e,e=n)):(Y=e,e=n)),e}const{QuotedString:kt,VerbatimString:Ct,Variable:Wt,VariableAssignment:Et,Word:Tt,List:_t,Whitespace:Lt}=tokens;if((r=i())!==n&&Y===t.length)return r;throw r!==n&&Y<t.length&&lt({type:"end"}),jt=nt,Qt=rt<t.length?t.charAt(rt):null,Ft=rt<t.length?ct(rt,rt+1):ct(rt,rt),new peg$SyntaxError(peg$SyntaxError.buildMessage(jt,Qt),jt,Qt,Ft);var jt,Qt,Ft}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.buildMessage=function(t,e){var r={literal:function(t){return'"'+s(t.text)+'"'},class:function(t){var e,r="";for(e=0;e<t.parts.length;e++)r+=t.parts[e]instanceof Array?i(t.parts[e][0])+"-"+i(t.parts[e][1]):i(t.parts[e]);return"["+(t.inverted?"^":"")+r+"]"},any:function(t){return"any character"},end:function(t){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function s(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function i(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}return"Expected "+function(t){var e,n,s,i=new Array(t.length);for(e=0;e<t.length;e++)i[e]=(s=t[e],r[s.type](s));if(i.sort(),i.length>0){for(e=1,n=1;e<i.length;e++)i[e-1]!==i[e]&&(i[n]=i[e],n++);i.length=n}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(t)+" but "+function(t){return t?'"'+s(t)+'"':"end of input"}(e)+" found."};var parser_1=(parser={SyntaxError:peg$SyntaxError,parse:peg$parse}).parse;function substitute(t,e){switch(t.kind){case 0:return new List(t.items.map(t=>substitute(t,e)).filter(t=>null!==t));case 2:let r=e[t.name];return r||(r=t.fallback?substitute(t.fallback,e):null),new SubstitutedVariable(t.name,r);case 3:return new VariableAssignment(t.name,substitute(t.value,e));case 6:return new QuotedString(t.contents.map(t=>"string"==typeof t?t:substitute(t,e)));default:return t}}function stringify(t){switch(t.kind){case 0:return t.items.map(stringify).filter(t=>null!==t).join("");case 2:return null;case 4:const e=t.value;return null==e?null:"string"==typeof e?e:stringify(e);case 3:return`${t.name}=${stringify(t.value)||""}`;case 6:return t.contents.reduce((t,e)=>"string"==typeof e?t+e:t+(stringify(e)||""),"");case 5:case 7:case 1:return t.contents}}function toShellArgs(t){switch(t.kind){case 0:const e=[];let r=!1;for(const n of t.items)if(1===n.kind)r=!0;else{const t=toShellArgs(n);null!==t&&(r||0===e.length?e.push(t):e[e.length-1]+=t,r=!1)}return e;case 2:return null;case 4:const n=t.value;return null==n?null:"string"==typeof n?n:join(toShellArgs(n));case 3:return`${t.name}=${join(toShellArgs(t.value))}`;case 6:return t.contents.reduce((t,e)=>"string"==typeof e?t+e:t+(toShellArgs(e)||""),"");case 5:case 7:case 1:return t.contents}}function join(t){return null==t?"":"string"==typeof t?t:t.join("")}function collapseWhitespace(t){switch(t.kind){case 0:const e=[];let r=!1;for(const n of t.items)if(1===n.kind)r=!0;else{const t=collapseWhitespace(n);null!==t&&(r&&e.length>0&&e.push(new Whitespace(" ")),r=!1,e.push(t))}return new List(e);case 4:const n=t.value;return null==n?null:"string"!=typeof n?collapseWhitespace(n):new SubstitutedVariable(t.name,n.trim().replace(/\s+/g," "));default:return t}}const parse=t=>parser_1(t),replace=(t,e)=>{return stringify(collapseWhitespace(substitute(parser_1(t),e)))};exports.List=List,exports.QuotedString=QuotedString,exports.SubstitutedVariable=SubstitutedVariable,exports.Variable=Variable,exports.VariableAssignment=VariableAssignment,exports.VerbatimString=VerbatimString,exports.Whitespace=Whitespace,exports.Word=Word,exports.collapseWhitespace=collapseWhitespace,exports.parse=parse,exports.replace=replace,exports.stringify=stringify,exports.substitute=substitute,exports.toShellArgs=toShellArgs;
//# sourceMappingURL=index.js.map
